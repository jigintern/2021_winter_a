<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=decice-width">
</head>

<body>
    <script type="module">
        import { fetchJSON } from "https://js.sabae.cc/fetchJSON.js";
        window.onload = async () => {
            const data = await fetchJSON("api/test");
            alert(data)
            console.log(data);
        };
    </script>
    <header>
        <h1>切り抜きまとめサイト</h1>
        
    </header>
    <style>
        .scroll {
            overflow:auto;
            width:100%;
            height:100vh;
        }
        .scroll img {
            height:calc(100vh/5);
            display:block;
            margin:1px;
        }
    </style>
    <div class="scroll" data-max="300" data-lastnum="5">
        <img src="1.jpg" />
        <img src="2.jpg" />
        <img src="3.jpg" />
        <img src="4.jpg" />
        <img src="5.jpg" />
    </div>
    <script>
        let imgNumber = 0;
        document.querySelectorAll('.scroll').forEach(elm => {
	        elm.onscroll = function () {
		        if (this.scrollTop + this.clientHeight >= this.scrollHeight) {
			        //スクロールが末尾に達した
			        if (parseInt(this.dataset.lastnum) < parseInt(this.dataset.max)) {
				        //未ロードの画像がある場合
				        this.dataset.lastnum = parseInt(this.dataset.lastnum) + 1;
				        let img = document.createElement('img');
				        img.src =  this.dataset.lastnum +'.jpg';
				        this.appendChild(img);
                        console.log(imgNumber+=1);
			        }
		        }
	        };
        });
    </script>
</body>

</html>